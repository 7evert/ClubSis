<!DOCTYPE html>
<html lang="en" ng-app="app">
<head>
    <!--<div id="head"></div>-->
    <meta charset="UTF-8">
    <title>ClubSis</title>
    <link rel="shortcut icon" type="image/x-icon" href="/img/Logos/ClubSisIcon.ico">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="webjars/jquery-ui/1.11.4/jquery-ui.css"/>
    <link rel='stylesheet' href='webjars/bootstrap/3.3.6/css/bootstrap.min.css'/>
    <link rel='stylesheet' href='webjars/jqgrid/4.7.0/css/ui.jqgrid.css'/>
    <link rel="stylesheet" href="webjars/fancybox/2.1.5/jquery.fancybox.css" type="text/css" media="screen"/>
    <title>Title</title>
    <!--Estilos nuevos creados se pueden mover a otro lado, a otro css nuevo-->
    <style type="text/css">
        .ui-th-ltr, .ui-jqgrid .ui-jqgrid-htable th.ui-th-ltr {
            background: #008D34;
        }

        .ui-jqgrid-sortable {
            color: azure;
            background-color: #008D34;
        }

        .ui-jqgrid-resize-ltr {
            background-color: #008D34;
        }

        .btn-warning {
            padding-top: 2px;
            padding-bottom: 2px;
            padding-right: 2px;
            padding-left: 2px;
            background-color: #ededed;
            border-color: #ededed;
        }

        .icono {
            width: 19px;
        }

        h4 {
            background: #008D34;
            color: white;
            padding-left: 30px;
            margin-left: 0px;
            padding-top: 2px;
            padding-bottom: 2px;
            margin-top: 0px;
        }

        hr {
            margin-top: 0px;
            margin-bottom: 10px;
        }

        .obligatorio {
            color: #FF0000;
        }
    </style>
</head>
<body ng-controller="BungalowController">
<div id="headerAdministrador"></div>
<div class="container">
    <!--Aqui irá su codigo intermedio para que hagan sus modificaciones de las pestañas el headerUsuario ya tiene-->
    <!--el banner de opciones de menu para el usuario, esto lo pueden utilizar para hacer sus vistas es una plantilla
    pueden generar otro javascript un archivo .js para que puedan usar sus javascripts en sus htmls, sean ordenados-->
    <div>
        <h3>
            REGISTRO DE BUNGALOW
        </h3>
    </div>
    <hr>
    <h4>DATOS DEL BUNGALOW</h4>

    <form class="form-horizontal">
        <div class="row">
            <div class="col-sm-6 col-lg-5">
                <div class="form-group">
                    <label for="sede" class="col-md-4 control-label">Sede<span class="obligatorio">*</span></label>
                    <div class="col-md-8">
                        <select class="form-control" id="sede" name="sede" ng-model="sede">
                        </select>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-5">
                <div class="form-group">
                    <label for="tipoBungalow" class="col-md-4 control-label">Tipo de Bungalow<span
                            class="obligatorio">*</span></label>
                    <div class="col-md-8">
                        <select class="form-control" id="tipoBungalow" name="tipoBungalow"
                                ng-model="tipoBungalow"></select>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-5">
                <div class="form-group">
                    <label for="valoracion" class="col-md-4 control-label">Valoración<span class="obligatorio">*</span></label>
                    <div class="col-md-8">
                        <select id="valoracion" class="form-control" ng-model="valoracion.valor"
                                ng-options="template.value as template.name for template in valoracion.valores">
                        </select>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-5">
                <div class="form-group">
                    <label for="piso" class="col-md-4 control-label">Piso<span class="obligatorio">*</span></label>
                    <div class="col-md-8">
                        <select id="piso" class="form-control" ng-model="piso.valor"
                                ng-options="template.value as template.name for template in piso.valores">
                        </select>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-5">
                <div class="form-group">
                    <label for="precio" class="col-md-4 control-label">Precio<span class="obligatorio">*</span></label>
                    <div class="col-md-4">
                        <input type="text" class="form-control" ng-model="precio" id="precio" placeholder="Precio">
                    </div>
                    <label class="col-md-4 control-label">nuevos soles</label>
                </div>
            </div>
            <div class="col-sm-12 col-lg-10">
                <div class="form-group">
                    <label for="caracteristicas" class="col-md-2 control-label">Características<span
                            class="obligatorio">*</span></label>
                    <div class="col-md-10">
                        <textarea id="caracteristicas" ng-model="caracteristicas" class="form-control"
                                  rows="4"></textarea>
                    </div>
                </div>
            </div>
            <div class="col-sm-12 col-lg-10">
                <div class="form-group">
                    <label for="descripcion" class="col-md-2 control-label">Descripción</label>
                    <div class="col-md-10">
                        <textarea id="descripcion" ng-model="descripcion" class="form-control" rows="4"></textarea>
                    </div>
                </div>
            </div>
            <div class="col-sm-12 col-lg-10">
                <div class="form-group">
                    <label for="urlFoto" class="col-md-2 control-label">Archivo Adjunto</label>
                    <div class="col-md-10">
                        <input id="urlFoto" ng-model="urlFoto" class="form-control">
                    </div>
                    <!--<div class="col-md-8">-->
                        <!--<input id="urlFoto" ng-model="urlFoto" class="form-control" type="file">-->
                    <!--</div>-->
                    <!--<div class="col-md-2">-->
                        <!--<a id="btnAdjuntar" class="btn btn-primary form-control">Adjuntar</a>-->
                    <!--</div>-->
                </div>
            </div>
            <div class="form-group">
                <div class="col-md-12">
                    <span class="obligatorio" style="margin-left: 180px;">(*) Estos campos son obligatorios</span>
                </div>
            </div>
            <div class="col-sm-7 col-lg-7">
            </div>
            <div class="col-sm-5 col-lg-5">
                <div class="form-group" style="margin-left: 95px;">
                    <a href="javascript:void(0)" class="btn btn-primary" id="btnRegistrar">Registrar</a>
                    <a href="MantenimientoBungalows.html" class="btn btn-primary" id="btnCancelar">Cancelar</a>
                </div>
            </div>
        </div>
    </form>
</div>
<br>
<br>
<div id="footer"></div>
<script src="webjars/jquery/2.2.3/jquery.min.js"></script>
<script src="webjars/jquery-ui/1.11.4/jquery-ui.min.js"></script>
<script src="webjars/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script src="webjars/jqgrid/4.7.0/js/i18n/grid.locale-en.js"></script>
<script src="webjars/jqgrid/4.7.0/js/jquery.jqGrid.js"></script>
<script type="text/javascript" src="webjars/fancybox/2.1.5/jquery.fancybox.pack.js"></script>
<script type="text/javascript" src="webjars/fancybox/2.1.5/jquery.fancybox.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.9/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.9/angular-route.min.js"></script>
<script src="webjars/noty/2.3.8/js/noty/jquery.noty.js"></script>
<script src="webjars/noty/2.3.8/js/noty/layouts/top.js"></script>
<script src="webjars/noty/2.3.8/js/noty/layouts/topLeft.js"></script>
<script src="webjars/noty/2.3.8/js/noty/layouts/topRight.js"></script>
<script src="webjars/noty/2.3.8/js/noty/themes/default.js"></script>
<script src="js/principal.js"></script>
<script src="js/Notificaciones.js"></script>
<script type="text/javascript">
    $("sede").click(
            $.getJSON("/api/sedes", null, function (data) {
                console.log(data);
                $("#sede option").remove(); // Remove all <option> child tags.
                $("#sede").append( // Append an object to the inside of the select box
                        $("<option></option>") // Yes you can do this.
                                .text("Elegir")
                                .val(-1)
                );
                $.each(data, function (index, item) { // Iterates through a collection
                    $("#sede").append( // Append an object to the inside of the select box
                            $("<option></option>") // Yes you can do this.
                                    .text(item.nombre)
                                    .val(item.id)
                    );
                });
            })
    );
    $("tipoBungalow").click(
            $.getJSON("/api/tiposbungalow", null, function (data) {
                $("#tipoBungalow option").remove(); // Remove all <option> child tags.
                $("#tipoBungalow").append( // Append an object to the inside of the select box
                        $("<option></option>") // Yes you can do this.
                                .text("Elegir")
                                .val(-1)
                );
                console.log(data);
                $.each(data, function (index, item) { // Iterates through a collection
                    $("#tipoBungalow").append( // Append an object to the inside of the select box
                            $("<option></option>") // Yes you can do this.
                                    .text(item.nombre)
                                    .val(item.id)
                    );
                });
            })
    );
    var app = angular.module('app', []);
    app.controller('BungalowController', function ($scope, $http) {
        $scope.valoracion = {};
        $scope.piso = {};
        <!--<select id="tipoDocumento" class="form-control" ng-model="tipoDocumento.valor" ng-options="template.value as template.name for template in tipoDocumento.valores">-->
        //Esto deberia cargarse desde la BD pero no hay una tabla que guarde esto u.u
        $scope.valoracion.valores = [
            {'name': 'Elegir', 'value': '-1'},
            {'name': '1 estrella', 'value': '1'},
            {'name': '2 estrellas', 'value': '2'},
            {'name': '3 estrellas', 'value': '3'},
            {'name': '4 estrellas', 'value': '4'},
            {'name': '5 estrellas', 'value': '5'}
        ];
        $scope.piso.valores = [
            {'name': 'Elegir', 'value': '-1'},
            {'name': 'Piso 1', 'value': '1'},
            {'name': 'Piso 2', 'value': '2'},
            {'name': 'Piso 3', 'value': '3'}
        ];

        $scope.valoracion.valor = $scope.valoracion.valores[0].value;
        $scope.piso.valor = $scope.piso.valores[0].value;

        $("#btnRegistrar").click(function () {
            $scope.registrarBungalow = function () {
                var data = {
                    //por preguntar
                    //idSuspension: null,
                    'estado': 1,
                    'descripcion': $scope.descripcion,
                    'precio': parseFloat($scope.precio),
                    'caracteristicas': $scope.caracteristicas,
                    'piso': parseInt($scope.piso.valor),
                    'valoracion': parseInt($scope.valoracion.valor),
                    'descripcion': $scope.descripcion,
                    'urlFoto': $scope.urlFoto,
                };
                console.log(data);
                if (!validarDatos()) {
                    $http.post('/api/bungalows/' + $("#tipoBungalow").val() + '/' + $("#sede").val(), data).success(function (data) {
                        console.log(data);
                        Notificaciones.hideAll();
                        Notificaciones.showProcesando();
                        setTimeout(function () {
                            location.href = "mantenimientoBungalows.html"
                        }, 1000);
                    })
                            .error(function (data) {
                                //aca lo que se hara en caso falle
                                Notificaciones.showError("Error al crear la entidad bungalow");
                            });
                }
            }();
        });
    });

    function validarDatos() {
        var sede = $("#sede").val();
        var tipoBungalow = $("#tipoBungalow").val();
        var valoracion = $("#valoracion").val();
        valoracion = valoracion.substring(valoracion.lastIndexOf(':') + 1);
        var piso = $("#piso").val();
        piso = piso.substring(piso.lastIndexOf(':') + 1);
        var precio = $("#precio").val();
        var caracteristicas = $("#caracteristicas").val();

        if (sede == -1) {
            Notificaciones.showError('Sede requerida');
            $("#sede").css("border-color", "red");
            return true;
        } else if (tipoBungalow == -1) {
            Notificaciones.showError('Tipo de bungalow requerido');
            $("#tipoBungalow").css("border-color", "red");
            return true;
        }else if (valoracion == -1) {
            Notificaciones.showError('Valoración requerida');
            $("#valoracion").css("border-color", "red");
            return true;
        }
        else if (piso == -1) {
            Notificaciones.showError('Piso requerido');
            $("#piso").css("border-color", "red");
            return true;
        }
        else if (!precio || parseInt(precio)<0) {
            if(parseInt(precio)<0){
                Notificaciones.showError('El precio no puede ser un valor negativo.');
                $("#precio").css("border-color", "red");
                return true;
            }
            Notificaciones.showError('Precio requerido');
            $("#precio").css("border-color", "red");
            return true;
        }else if (!caracteristicas) {
            Notificaciones.showError('Características del bungalow requerido');
            $("#caracteristicas").css("border-color", "red");
            return true;
        }
        return false;
    }

    $("#sede").click(function () {
        $("#sede").css("border-color", "#ccc");
    });
    $("#tipoBungalow").click(function () {
        $("#tipoBungalow").css("border-color", "#ccc");
    });
    $("#valoracion").click(function () {
        $("#valoracion").css("border-color", "#ccc");
    });
    $("#piso").click(function () {
        $("#piso").css("border-color", "#ccc");
    });
    $("#precio").click(function () {
        $("#precio").css("border-color", "#ccc");
    });
    $("#caracteristicas").click(function () {
        $("#caracteristicas").css("border-color", "#ccc");
    });
    //    });
</script>
</body>
</html>