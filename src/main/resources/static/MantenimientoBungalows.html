<!DOCTYPE html>
<html lang="en">
<head>
    <!--<div id="head"></div>-->
    <meta charset="UTF-8">
    <title>ClubSis</title>
    <link rel="shortcut icon" type="image/x-icon" href="/img/Logos/ClubSisIcon.ico">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="webjars/jquery-ui/1.11.4/jquery-ui.css"/>
    <link rel='stylesheet' href='webjars/bootstrap/3.3.6/css/bootstrap.min.css'/>
    <link rel='stylesheet' href='webjars/jqgrid/4.7.0/css/ui.jqgrid.css'/>
    <link rel="stylesheet" href="webjars/fancybox/2.1.5/jquery.fancybox.css" type="text/css" media="screen"/>
    <title>Title</title>
    <!--Estilos nuevos creados se pueden mover a otro lado, a otro css nuevo-->
    <style type="text/css">
        .ui-th-ltr, .ui-jqgrid .ui-jqgrid-htable th.ui-th-ltr {
            background: #008D34;
        }

        .ui-jqgrid-sortable {
            color: azure;
            background-color: #008D34;
        }

        .ui-jqgrid-resize-ltr {
            background-color: #008D34;
        }

        .btn-warning {
            padding-top: 2px;
            padding-bottom: 2px;
            padding-right: 2px;
            padding-left: 2px;
            background-color: #ededed;
            border-color: #ededed;
        }

        .icono {
            width: 19px;
        }

        h4 {
            background: #008D34;
            color: white;
            padding-left: 30px;
            margin-left: 0px;
            padding-top: 2px;
            padding-bottom: 2px;
            margin-top: 0px;
        }

        hr {
            margin-top: 0px;
            margin-bottom: 10px;
        }

        .centered1 {
            margin-right: 0px;
        }

        .centered2 {
            margin-right: 510px;
        }

        .myAltRowClassEven { background: #999999; border-color: #79B7E7; color: #ffffff; }
    </style>
</head>
<body>
<div id="headerAdministrador"></div>
<div class="container">
    <!--Aqui irá su codigo intermedio para que hagan sus modificaciones de las pestañas el headerUsuario ya tiene-->
    <!--el banner de opciones de menu para el usuario, esto lo pueden utilizar para hacer sus vistas es una plantilla
    pueden generar otro javascript un archivo .js para que puedan usar sus javascripts en sus htmls, sean ordenados-->
    <div>
        <h3>
            ADMINISTRACIÓN DE BUNGALOW
            <a href="registroBungalow.html" class="btn btn-primary" id="btnRegistrar" style="margin-left: 480px;">Añadir
                Bungalow</a>
        </h3>
    </div>
    <hr>
    <h4>CONSULTA DE BUNGALOW</h4>

    <form class="form-horizontal">
        <div class="row">
            <div class="col-sm-6 col-lg-5">
                <div class="form-group">
                    <label for="tipo" class="col-md-4 control-label">Sede</label>
                    <div class="col-md-8">
                        <select class="form-control" id="sede">
                            <option>Elegir</option>
                            <option>Chosica</option>
                            <option>Namekusein</option>
                            <option>Planeta del gran Kaiosama</option>
                            <option>Planeta Tierra</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-5">
                <div class="form-group">
                    <label for="tipo" class="col-md-4 control-label">Tipo</label>
                    <div class="col-md-8">
                        <select class="form-control" id="tipo">
                            <option>Elegir</option>
                            <option>Aseo personal</option>
                            <option>Electrodoméstico</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-5">
                <div class="form-group">
                    <label for="proveedor" class="col-md-4 control-label">Proveedor</label>
                    <div class="col-md-8">
                        <select class="form-control" id="proveedor">
                            <option>Elegir</option>
                            <option>Gloria</option>
                            <option>Coca-Cola</option>
                            <option>Backus</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-5">
                <div class="form-group">
                    <label for="nombre" class="col-md-4 control-label">Nombre</label>
                    <div class="col-md-8">
                        <input type="text" class="form-control" id="nombre" placeholder="Nombre del producto">
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-5">
                <div class="form-group">
                    <label for="descripcion" class="col-md-4 control-label">Descripcion</label>
                    <div class="col-md-8">
                        <input type="text" class="form-control" id="descripcion"
                               placeholder="Palabra clave de descripción del producto">
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-5">
                <div class="form-group">
                    <label for="stockInicial" class="col-md-4 control-label">Stock desde</label>
                    <div class="col-md-3">
                        <input type="text" class="form-control" id="stockInicial" placeholder="Cantidad">
                    </div>
                    <label for="stockFinal" class="col-md-2 control-label">hasta</label>
                    <div class="col-md-3">
                        <input type="text" class="form-control" id="stockFinal" placeholder="Cantidad">
                    </div>
                </div>
            </div>
            <div class="col-sm-7 col-lg-7">
            </div>
            <div class="col-sm-5 col-lg-5">
                <div class="form-group" style="margin-left: 110px;">
                    <a href="loginUsuario.html" class="btn btn-primary" id="btnCancelar">Cancelar</a>
                    <a href="javascript:void(0)" class="btn btn-primary" id="btnLimpiar">Limpiar</a>
                    <a href="javascript:void(0)" class="btn btn-primary" id="btnBuscar">Buscar</a>
                </div>
            </div>
        </div>
        <h4>RESULTADOS DE BUSQUEDA</h4>
        <div class="rowchangeg" style="width: 900px; margin-left: auto; margin-right: auto;">
            <table id="jqGrid"></table>
            <div id="jqGridPager"></div>
        </div>
        <br>
        <div class="leyenda">
            <span>Leyenda: </span>
            <span class="icono-editar"><img src="img/Iconos/ver.png" class="icono"></span> Ver Bungalow|
            <span class="icono-reprogramar"><img src="img/Iconos/modificar.png" class="icono"></span> Modificar Bungalow
            |
            <span class="icono-resultados"><img src="img/Iconos/eliminar.png" class="icono"></span> Eliminar Bungalow
        </div>
    </form>
</div>
<br>
<br>
<div id="footer"></div>
<script src="webjars/jquery/2.2.3/jquery.min.js"></script>
<script src="webjars/jquery-ui/1.11.4/jquery-ui.min.js"></script>
<script src="webjars/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script src="webjars/jqgrid/4.7.0/js/i18n/grid.locale-en.js"></script>
<script src="webjars/jqgrid/4.7.0/js/jquery.jqGrid.js"></script>
<script type="text/javascript" src="webjars/fancybox/2.1.5/jquery.fancybox.pack.js"></script>
<script type="text/javascript" src="webjars/fancybox/2.1.5/jquery.fancybox.js"></script>
<script src="webjars/noty/2.3.8/js/noty/jquery.noty.js"></script>
<script src="webjars/noty/2.3.8/js/noty/layouts/top.js"></script>
<script src="webjars/noty/2.3.8/js/noty/layouts/topLeft.js"></script>
<script src="webjars/noty/2.3.8/js/noty/layouts/topRight.js"></script>
<script src="webjars/noty/2.3.8/js/noty/themes/default.js"></script>
<script src="js/principal.js"></script>
<script src="js/Notificaciones.js"></script>
<script type="text/javascript">

    $("#jqGrid").jqGrid({
        url: '/api/bungalows', //Aqui va el metodo que me permitira obtener el JSON desde backend la ruta
        mtype: "GET",
        styleUI: 'Bootstrap',
        datatype: "json",
        gridview: true,
        emptyrecords: 'No se encontraron resultados',
//    @Id
//    @GeneratedValue
//    private Integer id;
//    private EstadoBungalow estado; //libre, en mantenimiento, ocupado, no irá en el formulario
//    private Double precio;
//    private String caracteristicas;
//    private Integer piso;
//    private Integer valoracion;
//    private String urlFoto;
//    private String descripcion;
//
//    @ManyToOne
//    private TipoBungalow tipoBungalow; // necesario (composición)
//
//    @ManyToOne
//    private Sede sede; // necesaria (composición)
//
//    @OneToMany(mappedBy = "bungalow")
//    @JsonIgnore
//    private Set<ReservaBungalow> reservaBungalowSet; // no es necesario al inicio (vacío)
        //Aqui hay que guiarse de la tabla de la base de datos que va a tener la tabla Productos
        colModel: [
            {index: 'id', name: 'id', align: 'center', width: 75},
            {index: 'precio', name: 'precio', align: 'center', width: 60},
            {index: 'piso', name: 'piso', align: 'center', width: 70},
            {index: 'valoracion', name: 'valoracion', align: 'center', width: 150},
            {index: 'tipoBungalow.nombre', name: 'tipoBungalow.nombre', align: 'center', width: 150},
            {index: 'sede.nombre', name: 'sede.nombre', align: 'center', width: 150},
            {index: 'estado', name: 'estado', align: 'center', width: 150},
            {index: 'Acciones', name: 'acciones', width: 150, align: 'center', formatter: acciones}
        ],
        colNames: [
            'N° Bungalow', 'Precio', 'Piso', 'Valoracion', 'Tipo de Bungalow', 'Sede', 'Estado', 'Acciones'
        ],
        viewrecords: true,
        height: 400,
        rowNum: 20,
        pager: "#jqGridPager",
        loadComplete: function () {
            var rowIds = $("#jqGrid").jqGrid('getDataIDs');
            for (i = 0; i <= rowIds.length; i++) {//iterate over each row
                rowData = $("#jqGrid").jqGrid('getRowData', rowIds[i]);
                //set background style if ColumnValue == true
                if (rowData['estado'] == "INHABILITADO") {
                    $("#jqGrid").jqGrid('setRowData', rowIds[i], false, "myAltRowClassEven");
                } //if
            }
            var cantFilas = $("#jqGrid").getGridParam("reccount");
            console.log(cantFilas);
            for (i = 1; i < cantFilas+cantFilas*4; i++) {
                var rowData = $('#jqGrid').jqGrid('getRowData', i);
                if (rowData.valoracion == "1")
                    rowData.valoracion = '1 estrella';
                else if (rowData.valoracion == "2")
                    rowData.valoracion = '2 estrellas';
                else if (rowData.valoracion == "3")
                    rowData.valoracion = '3 estrellas';
                else if (rowData.valoracion == "4")
                    rowData.valoracion = '4 estrellas';
                else if (rowData.valoracion == "5")
                    rowData.valoracion = '5 estrellas';
                $('#jqGrid').jqGrid('setRowData', i, rowData);
            }
            $('.icono-modificar').click(function () {
//                alert("Modificando bungalow");
                var idBungalow = $(this).attr('data-idBungalow-modificar');
                console.log("Id bungalow modificando: " + $(this).attr('data-idBungalow-modificar'));
                window.location = 'editarBungalow.html?id=' + idBungalow;
            });
            $('.icono-ver').click(function () {
//                alert("Ver bungalow");
                var idBungalow = $(this).attr('data-idBungalow-ver');
                console.log("Id bungalow ver: " + $(this).attr('data-idBungalow-ver'));
                window.location = 'verBungalow.html?id=' + idBungalow;
            });
            $('.icono-eliminar').click(function () {
                var idBungalow = $(this).attr('data-idBungalow-eliminar');
                console.log("Id bungalow eliminando: " + $(this).attr('data-idBungalow-eliminar'));
                $.noty.closeAll();
                noty({
                    text: '¿Está seguro de que desea eliminar el bungalow?',
                    type: 'warning',
                    buttons: [
                        {
                            addClass: 'btn btn-primary boton-1 centered1', text: 'Eliminar', onClick: function ($noty) {
                            Notificaciones.hideAll();
                            Notificaciones.showNoty("Eliminación exitosa", Notificaciones.type.SUCCESS);
                            //Llamada AJAX con la cual modificare por detrás en tiempo real el dato que voy a eliminar
                            //Simplemente se le cambiara el estado
                            $.post('/api/bungalows/eliminar',
                                    {idBungalow: idBungalow},
                                    function (response) {
                                        if (!response.error) {
                                            Notificaciones.hideAll();
                                            Notificaciones.showNoty("Eliminación exitosa", Notificaciones.type.SUCCESS);
                                            $('#grid').trigger('reloadGrid');
                                            setTimeout(function () {
                                                location.href = "mantenimientoBungalows.html"
                                            }, 1000);
                                        } else {
                                            Noty.hideAll();
                                            Noty.showError(response.mensaje, false, 3000);
                                        }
                                    });
                            $noty.close();
                        }
                        },
                        {
                            addClass: 'btn btn-primary boton-1 centered2', text: 'Cancelar', onClick: function ($noty) {
                            $noty.close();
                        }
                        }
                    ]
                });
            });
        }
    });

    $('#jqGrid').jqGrid('setGridWidth', '900');

    function acciones(cellValue, options, rowdata, action) {
        var acciones = '';
        acciones = '<a href="javascript:void(0)" class="btn btn-warning icono-ver" data-idBungalow-ver="' + rowdata['id'] + '" title="Ver Bungalow"><img src="img/Iconos/ver.png" class="icono"></a>' +
                '<a href="javascript:void(0)" class="btn btn-warning icono-modificar" data-idBungalow-modificar="' + rowdata['id'] + '" title="Modificar Bungalow"><img src="img/Iconos/modificar.png" class="icono"></a>' +
                '<a href="javascript:void(0)" class="btn btn-warning icono-eliminar" data-idBungalow-eliminar="' + rowdata['id'] + '" title="Eliminar Bungalow"><img src="img/Iconos/eliminar.png" class="icono"></a>';
        return acciones;
    }
</script>
</body>
</html>